<div class="dashboard-container">
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>

  <div *ngIf="error" class="error-message">
    <i class="fas fa-exclamation-circle"></i>
    <p>{{ error }}</p>
    <button (click)="loadData()">Tentar novamente</button>
  </div>

  <div *ngIf="!isLoading && !error">
    <div class="welcome-section">
      <h1>Bem-vindo, {{ currentUser?.name }}</h1>
      <p class="role">{{ getRoleLabel(currentUser?.TypeAccount?.type)}}</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>Total de Clientes</h3>
          <p class="stat-value">{{ totalClients }}</p>
          <p class="stat-change positive">
            <i class="fas fa-user-plus"></i>
            {{ newClientsThisMonth }} novos no mês
          </p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-content">
          <h3>Serviços Hoje</h3>
          <p class="stat-value">{{ appointments.length }}</p>
          <p class="stat-change">
            <i class="fas fa-check-circle"></i>
            {{ completedAppointmentsToday }} concluído(s)
          </p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-file-medical"></i>
        </div>
        <div class="stat-content">
          <h3>Serviços este mês</h3>
            <p class="stat-value">{{ totalAppointmentsThisMonth }}</p>

            <p class="stat-change">
              <i class="fas fa-check-circle"></i>
              {{ completedAppointmentsThisMonth }} concluído(s)
            </p>
        </div>
      </div>
    </div>

    <div class="appointments-section">
      <div class="section-header">
        <h2>Serviços do Dia</h2>
        <div class="header-actions">
          <button class="action-btn" (click)="navigateToNewConsultation()">
            <i class="fas fa-plus"></i>
            Novo Serviço
          </button>
          <a routerLink="/services" class="view-all">Ver todas</a>
        </div>
      </div>
      <div class="appointments-list">
        <div class="appointment-card" [ngClass]="getStatusCardClass(appointment)" [ngStyle]="getStatusStyles(appointment)" *ngFor="let appointment of appointments" (click)="navigateToConsultation(appointment)">
          <div class="appointment-info">
            <h3>{{ appointment.name_client || 'Cliente não informado' }}</h3>
            <p class="time">Horário: {{ formatTime(appointment.date_and_houres) }}</p>
            <p class="doctor">Prestador: {{ getProviderName(appointment) }}</p>
            <p class="services">Serviços: {{ getServicesList(appointment) }}</p>
          </div>
          <div class="appointment-status">
            <p class="status-label">Status:</p>
            <select
              [value]="getStatusValue(appointment)"
              (change)="updateStatus(appointment, $event)"
              (click)="$event.stopPropagation()"
            >
              <option value="active">Ativo</option>
              <option value="completed">Concluído</option>
              <option value="cancelled">Cancelado</option>
            </select>
          </div>
        </div>

        <!-- Mensagem quando não há agendamentos -->
        <div *ngIf="appointments.length === 0" class="no-appointments">
          <i class="fas fa-calendar-times"></i>
          <p>Nenhum agendamento para hoje</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Visualização do Agendamento (somente visualização) -->
  <app-schedule-view-modal
    *ngIf="showViewModal && selectedSchedule"
    [schedule]="selectedSchedule"
    [viewOnly]="true"
    (close)="closeViewModal()"
  ></app-schedule-view-modal>
</div>
